# Copilot Instructions for Power Query / M Language Extension

## Project Overview

This is a VS Code extension providing Language Server Protocol (LSP) support for the Power Query / M formula language. The extension consists of:

-   **Client**: VS Code extension (`client/` folder)
-   **Server**: Language server implementation (`server/` folder)
-   **Scripts**: Build and utility scripts (`scripts/` folder)

## Architecture

-   **Client-Server Model**: Uses LSP architecture with separate client and server processes
-   **TypeScript**: Written in TypeScript with webpack bundling
-   **Multi-package**: Root package.json manages client, server, and scripts subpackages

## Important Files to Monitor

-   `package.json` (root) - Main package configuration
-   `client/package.json` - Client dependencies including vscode-languageclient
-   `server/package.json` - Server dependencies including vscode-languageserver
-   `client/src/extension.ts` - Main extension entry point
-   `server/src/server.ts` - Language server implementation

## Build System

-   Uses webpack for bundling
-   Separate build processes for client and server
-   TypeScript compilation with multiple tsconfig files

## Testing

-   Mocha for server tests
-   Separate test configurations for client and server

## Common Patterns in This Codebase

-   Extension activation in `client/src/extension.ts`
-   Language server setup in `server/src/server.ts`
-   Webpack configuration for both client and server
-   npm scripts for building, testing, and packaging

## Useful Commands

-   `npm run build`- Build all packages
-   `npm run vsix` - Runs webpack and generates the .vsix installer for the extension
-   `npm run test:server` - Runs server unit tests. Requires `build` to be run first.
-   `npm run test:client` - Runs client UI tests using `vscode-test`. Requires the webpack process to be run first.
-   `npm run test` - Run both server and client tests.

## General Development Guidelines

-   Always test both client and server functionality after changes
-   Pay attention to API changes in LSP libraries
-   Consider backward compatibility when possible
-   Update all related dependencies together to avoid version conflicts

## Task Tracking

**Important**: For current task-specific information, progress tracking, and temporary notes, always check and use the `.copilot-current-task.md` file in the root directory. This file contains:

-   Current task objectives and progress
-   Task-specific checklists and breaking changes
-   Temporary analysis and investigation notes
-   Status updates for the current task

Create or update this file at the beginning of each task session and refer to it throughout the work. This file is gitignored and should not be committed to the repository.
